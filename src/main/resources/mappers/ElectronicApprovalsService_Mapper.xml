<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ezen.ezenhr.persistance.ElectronicApprovalsService_Mapper">

	<insert id="insertElectronicApproval" parameterType="eav">
	    <selectKey keyProperty="aidx" order="AFTER" resultType="int">
	        SELECT LAST_INSERT_ID() AS aidx
	    </selectKey>
	    INSERT INTO ElectronicApprovals (approvalStatus, aDate, uidx, approvalUidx1, approvalUidx2)
	    VALUES ('W', now(), #{uidx}, #{approvalUidx1}, #{approvalUidx2})
	</insert>
	
<select id="getEAListByApproverUidxWithAdate" resultType="java.util.Map" parameterType="int">
    <![CDATA[
        SELECT eav.*, ea.adate
        FROM ElectronicApprovals eav
        LEFT JOIN LeaveTable lt ON eav.aidx = lt.aidx
        LEFT JOIN ElectronicApprovals ea ON eav.aidx = ea.aidx
        WHERE eav.approvalUidx1 = #{uidx} OR eav.approvalUidx2 = #{uidx}
    ]]>
</select>
</mapper>